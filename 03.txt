WITH selected_videos AS (
SELECT
    communities.name AS community_name,
    communities_users.user_id,
    video.size AS video_size
FROM video
    INNER JOIN communities_users
        ON video.owner_id = communities_users.user_id
    RIGHT JOIN communities
        ON communities.id = communities_users.community_id
)

SELECT DISTINCT
    community_name,
    AVG(video_size) OVER (PARTITION BY community_name),
    FIRST_VALUE(first_name || ' ' || last_name) OVER (PARTITION BY community_name
        ORDER BY video_size DESC NULLS LAST) as username
FROM selected_videos
    LEFT JOIN users
        ON selected_videos.user_id = users.id;
